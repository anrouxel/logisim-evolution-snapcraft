name: logisim-evolution-snapcraft
license: GPL-3.0
summary: Logisim is a digital circuit simulator
description: |
  Github (compilation) : https://github.com/anrouxel/logisim-evolution-snapcraft
base: core18
grade: stable
confinement: strict

adopt-info: logisim-evolution-snapcraft

architectures:
  - build-on: amd64

layout:
  # Gtk-Message: Failed to load module "canberra-gtk-module"
  /usr/lib/$SNAPCRAFT_ARCH_TRIPLET/gtk-2.0/modules:
    symlink: $SNAP/usr/lib/$SNAPCRAFT_ARCH_TRIPLET/gtk-2.0/modules
  /usr/lib/$SNAPCRAFT_ARCH_TRIPLET/gtk-3.0/modules:
    symlink: $SNAP/usr/lib/$SNAPCRAFT_ARCH_TRIPLET/gtk-3.0/modules

apps:
  logisim-evolution-snapcraft:
    extensions: [gnome-3-28]
    command: usr/lib/jvm/java-16-openjdk-amd64/bin/java -jar $SNAP/logisim/logisim-evolution.jar
    environment:
      _JAVA_OPTIONS: "-Duser.home=$SNAP_USER_DATA"
      XDG_DATA_HOME: $SNAP/usr/share
      FONTCONFIG_PATH: $SNAP/etc/fonts/conf.d
      FONTCONFIG_FILE: $SNAP/etc/fonts/fonts.conf
    plugs:
      - gsettings
      - opengl
      - home
      - desktop
      - desktop-legacy
      - wayland
      - x11
      - unity7
      - network

parts:     
  logisim-evolution-snapcraft:
    plugin: gradle
    source: https://github.com/logisim-evolution/logisim-evolution.git
    source-type: git
    gradle-output-dir: "build/libs"
    gradle-options: [shadowJar]
    override-pull: |
      snapcraftctl pull
      git checkout "$(git describe --tags `git rev-list --tags --max-count=1`)" -b latest
      snapcraftctl set-version "$(git describe --tags | sed 's/v//' | sed "s/-g/%/"  | cut -d "%" -f1)"
    override-build: |
      snapcraftctl build
      cd build/libs
      mv *-all.jar logisim-evolution.jar
      mv logisim-evolution.jar $SNAPCRAFT_PART_INSTALL/
      cd $SNAPCRAFT_PART_INSTALL/
      mkdir logisim
      mv logisim-evolution.jar $SNAPCRAFT_PART_INSTALL/logisim
      cd $SNAPCRAFT_PART_INSTALL/
      update-java-alternatives --set /usr/lib/jvm/java-1.16.0-openjdk-amd64
    build-packages:
      - git
      - sed
      - openjdk-16-jre
      - openjdk-16-jdk
    stage-packages:
      - openjdk-16-jre
      - openjdk-16-jdk
      - libcanberra-gtk-module
      - libcanberra-gtk3-module
      - fontconfig

package-repositories:
 - type: apt
   ppa: openjdk-r/ppa
